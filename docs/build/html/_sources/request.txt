Запрос
======


**ids** *(обязательно)*

    Айдишники профилей.

**start_date** *(обязательно)*

    Дата начала.

**end_date** *(обязательно)*

    Дата конца.

**dimensions**

    Параметр разбивает метрики по основным критериям. Например, ga:browser или ga:city.
    К примеру, при запросе общего числа просмотров страниц сайта, можно разбить просмотры по браузерам.
    При использовании данного параметра, необходимо быть в курсе следующих ограничений:

    * Можно указать максимум 7 вариантов данного параметра в запросе
    * Нельзя послать запрос, состоящий только из dimensions.
      Необходимо совместить все запрашиваемые параметры, хотя бы для одной метрики.
    * Только определенные dimensions могут быть запрошены в одном запросе.
      Для проверки валидности комбинации, можно использовать инструмент по следующей
      ссылке https://developers.google.com/analytics/devguides/reporting/core/dimsmets

**metrics** *(обязательно)*

    Статистические данные по активности пользователей на сайте. Например, клики или просмотры страниц.
    Если запрос не содержит параметра dimensions, возвращаемые метрики будут представлять совокупные значения
    на указанный диапазон дат. Однако, когда dimensions присутствует, полученные значения будут сегементированы по
    значениям dimensions. Например, ga:pageviews, запрошенный с ga:country, вернет совокупные значения просомтров
    по странам. При запросе metrics, необходимо учитывать:

    * Любой запрос должен содержать не менее одной метрики.
    * Нельзя подставлять более десяти метрик.
    * Большинство комбинаций метрик из нескольких категорий могут быть использованы вместе,
      если не указан параметр dimensions.
    * Metrics может быть использован только с определенными значениями dimensions или metrics. Доступные комбинации
      можно составлять с помощью инструмента по следующей ссылке
      https://developers.google.com/analytics/devguides/reporting/core/dimsmets

**sort**

    Перечень из значений параметров metrics и dimensions, указывающий на порядок сортировки для возвращаемых значений.

    * Порядок сортировки задается слева направо.
    * Сортировка по умолчанию задается как восходящая. Чтобы указать нисходящий порядок сортировки, необходимо указать
      префикс "-" перед запрашиваемым полем.

    Например, для того, чтобы ответить на вопрос, из каких стран чаще посещают сайт и с помощью каких браузеров это
    делают, необходимо указать ``sort=ga:country,ga:browser``.

    При использовании параметра sort, необходимо иметь в виде следующие моменты:

    * Сортировать можно только по значениям dimensions или metrics, которые были использованы в запросе.
      Если для сортировки используется поле, которого нет в указанных значениях dimensions или metrics, произойдет
      ошибка.
    * По умолчанию, строки сортируются в алфавитном порядке в en-US локали. Числа и даты сортируются
      по возврастанию.

**filters**

    Параметр filters ограничивает данные, возвращаемые запросом. Для использования параметра filters, необходимо
    указать dimensions или metrics и затем выражение фильтрации. Например, следующий запрос запрашивает
    ga:pageviews и ga:browser для профиля 12134, когда ga:browser dimension начинается со строки Firefox:

    .. code-block:: rest

        https://www.googleapis.com/analytics/v3/data/ga
        ?ids=ga:12134
        &dimensions=ga:browser
        &metrics=ga:pageviews
        &filters=ga:browser%3D~%5EFirefox
        &start-date=2007-01-01
        &end-date=2007-12-31

    Отфильтрованные запросы органичивают строки, которые включаются (или исключаются) из запроса. Каждая строка
    результата сравнивается с фильтром, и если фильтр будет соответствовать, то строка сохраняется, а если не
    соответствует - отбрасывается.

    * **URL кодирование:** Клиентские библиотеки для Google API автоматически кодируют операторы фильтра.
    * **Dimension фильтрация:** Фильтрация происходит перед агрегацией данных, так что возвращаемые метрики
      агрегируют уже отфильтрованные данные.
    * **Metrics фильтрация:** Фильтрация метрик происходит после агрегации метрик.
    * **Допустимые комбинации:** Можно фильтровать по dimensions и metrics, которые не являются частью запроса, при
      условии, что они представляют собой допустимую комбинацию. Например, можно составить запрос с количеством
      просмотров страниц по списку дат, фильтруя по браузеру.

    **Операторы фильтрации для metrics**

    ======== ================= ======== =============================================================================
    ==       Равно             %3D%3D   Возвращает только те результаты, когда время пользователя на странице было 10
                                        секунд
                                        ``filters=ga:timeOnPage%3D%3D10``
    -------- ----------------- -------- -----------------------------------------------------------------------------
    !=       Не равно          !%3D     Вернуть результат, когда время пользователя на странице не равно 10 секунд
                                        ``filters=ga:timeOnPage!%3D10``
    -------- ----------------- -------- -----------------------------------------------------------------------------
    >        Больше чем        %3E      Вернуть результаты, когда время пользователя на странице больше, чем 10
                                        секунд
                                        ``filters=ga:timeOnPage%3E10``
    -------- ----------------- -------- -----------------------------------------------------------------------------
    <        Меньше чем        %3C      Вернуть результаты, когда время пользователя на странице меньше чем 10 секунд
                                        ``filters=ga:timeOnPage%3C10``
    -------- ----------------- -------- -----------------------------------------------------------------------------
    >=       Больше либо равно %3E%3D   Вернуть результаты, когда время пользователя на странице больше либо равно 10
                                        ``filters=ga:timeOnPage%3E%3D10``
    -------- ----------------- -------- -----------------------------------------------------------------------------
    <=       Меньше либо равно %3C%3D   Вернуть результаты, когда время пользователя на странице меньше либо равно 10
                                        ``filters=ga:timeOnPage%3C%3D10``
    ======== ================= ======== =============================================================================

    **Операторы фильтрации для dimensions**

    ======== ======================== ======== ======================================================================
    ==       Точное совпадение        %3D%3D   Аггрегировать метрики, когда город равен Irvine
                                               ``filters=ga:city%3D%3DIrvine``
    -------- ------------------------ -------- ----------------------------------------------------------------------
    !=       Не равно                 !%3D     Аггрегировать метрики, когда город не равен Irvine
                                               ``filters=ga:city!%3DIrvine``
    -------- ------------------------ -------- ----------------------------------------------------------------------
    =@       Содержит подстроку       %3D@     Аггрегировать метрики, когда город содержит York
                                               ``filters=ga:city%3D@York``
    -------- ------------------------ -------- ----------------------------------------------------------------------
    !@       Не содержит подстроку    !@       Аггрегировать метрики, когда город не содержит York
                                               ``filters=ga:city!@York``
    -------- ------------------------ -------- ----------------------------------------------------------------------
    =~       Содержит соответствие    %3D~     Аггрегировать метрики, когда город начинается с New
             регулярному выражению             ``filters=ga:city%3D~%5ENew.*``
                                               (%5E в URL кодируется из ^ символа)
    -------- ------------------------ -------- ----------------------------------------------------------------------
    !~       Не содержит соответствие !~       Аггрегировать метрики, когда город не начинается с New
             регулярному выражению             ``filters=ga:city!~%5ENew.*``
    ======== ======================== ======== ======================================================================

    **Выражения фильтрации**

    Важные правила для составления выражений фильтрации:

    * Символы должны быть url-кодированы
    * Точка с запятой, запятая, и бекслеш должны быть экранированы обратной наклонной чертой,
      когда они появляются в выражении.
    * В выражениях фильтрации можно использовать perl-совместимые регулярные выражения с помощью =~ и !~.
      Для их использования есть некоторые правила:

      1. Регулярное выражение длиннее 128 символов может привести к 400 Bad Request ответу от сервера.

      2. Регулярные выражение регистро-независимы

    **Комбинирование фильтров**

    Фильтры могут комбинироваться с помощью OR и AND операторов булевой логики. Это позволяет эффективно расширить
    лимит 128 символов в выражении фильтра.

    Оператор OR определяется использованием символа (,).
    Например, ``ga:country==United%20States,ga:country==Canada``

    Оператор AND определяется использованием символа (;).
    Например, ``ga:country==United%20States;ga:browser==Firefox``

**segment**

**samplingLevel**

    Необходимо использовать данный параметр, чтобы установить уровень дискретизации (кол-во сеансов, используемых
    для рассчета результата). Допустимые значения:

    **DEFAULT** - возвращает ответ с размером выборки, которая уравновешивает скорость и точность.

    **FASTER** - возвращает быстрый отклик с меньши размером выборки.

    **HIGHER_PRECISION** - возвращает более точный ответ, используя больший размер выборки, но это может привести
    к медленному ответу.

    По умолчанию используется уровень DEFAULT.

**start-index**

    Если не указан, начальным индексом является 1 (Результат начинает с первой строки, а не с нулевой).
    Данный параметр необходимо использовать в качестве механизма нумерации страниц вместе с параметром max-results
    для ситуаций, когда totalResults превышает 10 000 и необходимо извлечь строки от 10 001.

**max-results**

    Максимальное количество строк в ответе. По умолчанию используется 10 000.

**output**

    Данный параметр используется уста установки типы вывода данных. Допустимые значения:

    **JSON** - используется по умолчанию и выводит ответ в JSON объекте в свойстве rows.

    **dataTable** - выводит в dataTable свойстве Data Table объект. Данный объект описан по следующей ссылке
    https://developers.google.com/chart/interactive/docs/datatables_dataviews#datatablesdataviews

**fields**

    Указывает поля, содержащиеся в ответе. Значение необходимо указывать с помощью XPath синтаксиса.
    Поддерживаемый синтаксис описан ниже:

    * Используйте запятую, чтобы выбрать несколько полей.

    * Используйте a/b, чтобы выбрать b, находящийся в области поля с.

    * Используйте саб-селектор, чтобы указать конкретный набор под-полей с помощью скобок ( ).
      Например ``fields=columnHeaders(name,dataType)`` вернет только name и dataType поля в columnHeaders массиве.
